{var Sala=ClientGame.Sala,Game=ClientGame.Game;Sala.Controles.calcularCasilla=function(x,y){var casilla_seleccionada=null,tamano_casilla=ClientGame.dimensiones_casilla.slice();tamano_casilla[0]*=ClientGame.zoom;tamano_casilla[1]*=ClientGame.zoom;var cursor_coords=[x-((Sala.estructura.nCasillas_x-1)*(tamano_casilla[0]/2+1))-(tamano_casilla[0]*.34),y],coords_x=Math.floor(cursor_coords[0]/(tamano_casilla[0]/2+1)),coords_y=Math.floor((cursor_coords[1]-(coords_x*tamano_casilla[1]/2))/tamano_casilla[1]);coords_x=Math.floor((cursor_coords[0]+(coords_y*(tamano_casilla[0]/2+1)))/(tamano_casilla[0]/2+1));return[coords_y,coords_x]}
var moverSala={tipoClick:null,clicked:!1,clicked_x:0,clicked_y:0,camara:Game.camara.slice()}
Sala.Controles.EVENTO_mousedown=function(event){var x=event.clientX,y=event.clientY;if(event.touches&&event.touches[0]){x=event.touches[0].clientX;y=event.touches[0].clientY}
moverSala.tipoClick=event.type;moverSala.clicked=!0;moverSala.clicked_x=x-Game.camara[0];moverSala.clicked_y=y-Game.camara[1];moverSala.camara=Game.camara.slice()}
Sala.Controles.EVENTO_mousemove=function(event){var x=event.clientX,y=event.clientY;if(event.touches&&event.touches[0]){x=event.touches[0].clientX;y=event.touches[0].clientY}
if(moverSala.clicked){Game.moverCamara(x-moverSala.clicked_x,y-moverSala.clicked_y)}
var coordenadas=Sala.Controles.calcularCasilla(x-Game.camara[0],y-Game.camara[1]);Sala.Controles.selector.coordenadas=coordenadas.slice();Sala.Controles.selector.casilla=Sala.verCasilla(coordenadas[0],coordenadas[1]);Game.pos_mouse_camara[0]=x-Game.camara[0];Game.pos_mouse_camara[1]=y-Game.camara[1]}
Sala.Controles.EVENTO_mouseup=function(x,y){moverSala.clicked=!1;if(Game.camara.toString()==moverSala.camara.toString()){if(Sala.Controles.selector.casilla){let coords=Sala.Controles.selector.coordenadas;CAMINAR_YO(Sala.miAvatar,coords[0],coords[1])}}}
{let ultimoWheel=0;Sala.container.addEventListener('wheel',function(event){var timestamp=(new Date).getTime();if(timestamp-ultimoWheel<200)return;ultimoWheel=timestamp;ClientGame.cambiarZoom(event.deltaY<0?'aumentar':'disminuir')})}
Sala.Controles.preparar=function(){Sala.container.addEventListener('mousedown',Sala.Controles.EVENTO_mousedown);Sala.container.addEventListener('mousemove',Sala.Controles.EVENTO_mousemove);Sala.container.addEventListener('mouseup',Sala.Controles.EVENTO_mouseup);Sala.container.addEventListener('touchstart',Sala.Controles.EVENTO_mousedown);Sala.container.addEventListener('touchmove',Sala.Controles.EVENTO_mousemove);Sala.container.addEventListener('touchend',Sala.Controles.EVENTO_mouseup)}
Sala.Controles.cancelar=function(){Sala.container.removeEventListener('mousedown',Sala.Controles.EVENTO_mousedown);Sala.container.removeEventListener('mousemove',Sala.Controles.EVENTO_mousemove);Sala.container.removeEventListener('mouseup',Sala.Controles.EVENTO_mousedown);Sala.container.removeEventListener('touchstart',Sala.Controles.EVENTO_mousedown);Sala.container.removeEventListener('touchmove',Sala.Controles.EVENTO_mousemove);Sala.container.removeEventListener('touchend',Sala.Controles.EVENTO_mouseup)}}